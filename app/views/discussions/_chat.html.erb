<div id='chat-container'>

  <% content_for :javascript do %>
    <script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
    <%= tag :meta, name: 'discussion_url', content: @discussion.url %>
    <%= tag :meta, name: 'current_user_id', content: current_user.id %>
    <%= javascript_include_tag :chat %>
  <% end %>

  <ul id="messages">
    <%= render @messages %>
  </ul>

  <% if current_user.has_full_name? %>
    <%= form_for @message, url: discussion_messages_path(@discussion), remote: true do |f| %>
      <%= f.text_area :content,  rows: '3' %>
    <% end %>
  <% else %>
    <p>
      Don't be a stranger! Enter your name
      <% unless signed_in? %>, or <%= link_to 'sign in', sign_in_path %>,<% end %>
      to begin chating.
    </p>
    <%= form_tag discussion_names_path(@discussion), id: "new_name" do %>
      <div class='control-group'>
        <%= text_field_tag :first_name, nil, placeholder: 'First name' %>
      </div>
      <div class='control-group'>
        <%= text_field_tag :last_name, nil, placeholder: 'Last name' %>
      </div>
      <div class='form-actions'>
        <%= submit_tag 'Join discussion' %>
      </div>
    <% end %>
  <% end %>
</div>
